{"ast":null,"code":"var _jsxFileName = \"/home/alan/git/joystck-ros/src/Components/Joystck.js\";\nimport React, { Component } from 'react';\nimport ReactNipple from 'react-nipple';\nimport ROSLIB from 'roslib';\nimport Config from \"./config\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Joystck extends Component {\n  constructor() {\n    super();\n    this.state = {\n      ros: null,\n      linear: 0,\n      angular: 0,\n      stopPub: false\n    };\n    this.init_connection();\n    this.move = this.move.bind(this);\n    this.moveAction = this.moveAction.bind(this);\n  }\n\n  componentDidMount() {\n    this.cmdVelPublisher = new ROSLIB.Topic({\n      ros: this.ros,\n      name: '/turtle1/cmd_vel',\n      messageType: 'geometry_msgs/Twist'\n    });\n    this.cmdVelPublisher.advertise();\n  }\n\n  componentWillUnmount() {\n    this.cmdVelPublisher.unadvertise();\n    clearTimeout(this.timer);\n    clearInterval(this.cmdPubTimer);\n  }\n\n  init_connection() {\n    // eslint-disable-next-line\n    this.state.ros = new ROSLIB.Ros();\n    this.state.ros.on(\"connection\", () => {\n      console.info(\"Connected to ROS:TELEOP\");\n    });\n    this.state.ros.on(\"close\", () => {\n      console.warn(\"Disconnected from ROS:TELEOP\");\n      setTimeout(() => {\n        try {\n          this.state.ros.connect(\"ws://\" + Config.ROSBRIDGE_SERVER_IP + \":\" + Config.ROSBRIDGE_SERVER_PORT + \"\");\n        } catch (error) {\n          console.error(\"Connection problem : TELEOP\");\n        }\n      }, Config.RECONNECTION_TIMER);\n    });\n    this.state.ros.on(\"error\", error => {});\n\n    try {\n      this.state.ros.connect(\"ws://\" + Config.ROSBRIDGE_SERVER_IP + \":\" + Config.ROSBRIDGE_SERVER_PORT + \"\");\n    } catch (error) {\n      console.error(\"Connection problem : TELEOP\");\n    }\n  }\n\n  move(evt, data) {\n    var max_linear = 5.0; // m/s\n\n    var max_angular = 2.0; // rad/s\n\n    var max_distance = 75.0; // pixels;\n\n    var linear_speed = Math.sin(data.angle.radian) * max_linear * data.distance / max_distance;\n    var angular_speed = -Math.cos(data.angle.radian) * max_angular * data.distance / max_distance;\n    this.setState({\n      linear: linear_speed,\n      angular: angular_speed\n    });\n  }\n\n  moveAction() {\n    let {\n      linear,\n      angular\n    } = this.state;\n\n    if (this.state.stopPub) {\n      linear = 0.0;\n      angular = 0.0;\n      clearInterval(this.cmdPubTimer);\n      this.setState({\n        stopPub: false\n      });\n    }\n\n    let twist = new ROSLIB.Message({\n      linear: {\n        x: 0,\n        y: 0,\n        z: 0\n      },\n      angular: {\n        x: 0,\n        y: 0,\n        z: 0\n      }\n    });\n\n    if (linear !== undefined && angular !== undefined) {\n      twist.linear.x = linear;\n      twist.angular.z = angular;\n    } else {\n      twist.linear.x = 0;\n      twist.angular.z = 0;\n    }\n\n    this.cmdVelPublisher.publish(twist);\n  }\n\n  loopMoveAction() {\n    this.cmdPubTimer = setInterval(this.moveAction, 25);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(ReactNipple, {\n        options: {\n          mode: 'static',\n          position: {\n            top: '50%',\n            left: '50%'\n          },\n          color: '#0066ff',\n          size: 150\n        },\n        style: {\n          width: 150,\n          height: 150,\n          position: 'relative'\n        },\n        onMove: (evt, data) => this.move(evt, data),\n        onStart: (evt, data) => this.loopMoveAction(),\n        onEnd: (evt, data) => this.setState({\n          stopPub: true\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Joystck;","map":{"version":3,"sources":["/home/alan/git/joystck-ros/src/Components/Joystck.js"],"names":["React","Component","ReactNipple","ROSLIB","Config","Joystck","constructor","state","ros","linear","angular","stopPub","init_connection","move","bind","moveAction","componentDidMount","cmdVelPublisher","Topic","name","messageType","advertise","componentWillUnmount","unadvertise","clearTimeout","timer","clearInterval","cmdPubTimer","Ros","on","console","info","warn","setTimeout","connect","ROSBRIDGE_SERVER_IP","ROSBRIDGE_SERVER_PORT","error","RECONNECTION_TIMER","evt","data","max_linear","max_angular","max_distance","linear_speed","Math","sin","angle","radian","distance","angular_speed","cos","setState","twist","Message","x","y","z","undefined","publish","loopMoveAction","setInterval","render","mode","position","top","left","color","size","width","height"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport ReactNipple from 'react-nipple';\nimport ROSLIB from 'roslib';\nimport Config from \"./config\";\n\nclass Joystck extends Component {\n\n    state = {\n\t\tros : null,\n        linear: 0,\n        angular: 0,\n        stopPub: false,\n\t};\n\tconstructor(){\n\t\tsuper();\n\t\tthis.init_connection();\n\n        this.move = this.move.bind(this);\n        this.moveAction = this.moveAction.bind(this);\n\t}\n\n    componentDidMount() {\n\n        this.cmdVelPublisher = new ROSLIB.Topic({\n            ros: this.ros,\n            name: '/turtle1/cmd_vel',\n            messageType: 'geometry_msgs/Twist'\n        });\n\n        this.cmdVelPublisher.advertise();\n    }\n\n    componentWillUnmount() {\n        this.cmdVelPublisher.unadvertise();\n        clearTimeout(this.timer); \n        clearInterval(this.cmdPubTimer);\n    }\n\n\tinit_connection(){\n\t\t// eslint-disable-next-line\n\t\tthis.state.ros = new ROSLIB.Ros();\n\n\t\tthis.state.ros.on(\"connection\", () => {\n\t\t\tconsole.info(\"Connected to ROS:TELEOP\");\n\t\t});\n\n\t\tthis.state.ros.on(\"close\", () => {\n\t\t\tconsole.warn(\"Disconnected from ROS:TELEOP\");\n\t\t\tsetTimeout(()=>{\n\t\t\t\ttry{\n\t\t\t\t\tthis.state.ros.connect(\n\t\t\t\t\t\t\"ws://\"+Config.ROSBRIDGE_SERVER_IP+\":\"+Config.ROSBRIDGE_SERVER_PORT+\"\"\n\t\t\t\t\t);\n\t\t\t\t}catch(error){\n\t\t\t\t\tconsole.error(\"Connection problem : TELEOP\");\n\t\t\t\t}\n\t\t\t},Config.RECONNECTION_TIMER);\n\t\t});\n\n\t\tthis.state.ros.on(\"error\", (error) => {});\n\n\t\ttry{\n\t\t\tthis.state.ros.connect(\n\t\t\t\t\"ws://\"+Config.ROSBRIDGE_SERVER_IP+\":\"+Config.ROSBRIDGE_SERVER_PORT+\"\"\n\t\t\t);\n\t\t}catch(error){\n\t\t\tconsole.error(\"Connection problem : TELEOP\");\n\t\t}\n\t}\n    move(evt, data) {\n\n        var max_linear = 5.0; // m/s\n        var max_angular = 2.0; // rad/s\n        var max_distance = 75.0; // pixels;\n        var linear_speed = Math.sin(data.angle.radian) * max_linear * data.distance/max_distance;\n        var angular_speed = -Math.cos(data.angle.radian) * max_angular * data.distance/max_distance;\n\n        this.setState({linear: linear_speed, angular: angular_speed});\n    }\n\n    moveAction() {\n\n        let {linear, angular} = this.state;\n\n        if(this.state.stopPub){\n            linear = 0.0;\n            angular = 0.0;\n            clearInterval(this.cmdPubTimer)\n            this.setState({stopPub: false})\n        }\n\n        let twist = new ROSLIB.Message({ \n            linear: { x: 0, y: 0, z: 0 },\n            angular: { x: 0, y: 0, z: 0 }\n        });\n\n        if (linear !== undefined && angular !== undefined) {\n            twist.linear.x = linear;\n            twist.angular.z = angular;\n        } else {\n            twist.linear.x = 0;\n            twist.angular.z = 0;\n        }\n        this.cmdVelPublisher.publish(twist);\n    }\n\n    loopMoveAction() {\n\n        this.cmdPubTimer = setInterval(this.moveAction, 25);\n    }\n\n    render() {\n        return (\n            <div>\n                <ReactNipple\n                    options={{ mode: 'static', position: { top: '50%', left: '50%' }, color: '#0066ff', size: 150 }}\n                    style={{\n                        width: 150,\n                        height: 150,\n                        position: 'relative'\n                    }}\n                    onMove={(evt, data) => this.move(evt, data)}\n                    onStart={(evt, data) => this.loopMoveAction()}\n                    onEnd={(evt, data) => this.setState({stopPub: true})}\n                    />\n            </div>\n        );\n    }\n}\n\nexport default Joystck;"]},"metadata":{},"sourceType":"module"}