{"ast":null,"code":"(function (f) {\n  if (typeof exports === \"object\" && typeof module !== \"undefined\") {\n    module.exports = f();\n  } else if (typeof define === \"function\" && define.amd) {\n    define([], f);\n  } else {\n    var g;\n\n    if (typeof window !== \"undefined\") {\n      g = window;\n    } else if (typeof global !== \"undefined\") {\n      g = global;\n    } else if (typeof self !== \"undefined\") {\n      g = self;\n    } else {\n      g = this;\n    }\n\n    g.nipplejs = f();\n  }\n})(function () {\n  var define, module, exports;\n  'use strict'; // Constants\n\n\n  var isTouch = !!('ontouchstart' in window);\n  var isPointer = window.PointerEvent ? true : false;\n  var isMSPointer = window.MSPointerEvent ? true : false;\n  var events = {\n    touch: {\n      start: 'touchstart',\n      move: 'touchmove',\n      end: 'touchend, touchcancel'\n    },\n    mouse: {\n      start: 'mousedown',\n      move: 'mousemove',\n      end: 'mouseup'\n    },\n    pointer: {\n      start: 'pointerdown',\n      move: 'pointermove',\n      end: 'pointerup, pointercancel'\n    },\n    MSPointer: {\n      start: 'MSPointerDown',\n      move: 'MSPointerMove',\n      end: 'MSPointerUp'\n    }\n  };\n  var toBind;\n  var secondBind = {};\n\n  if (isPointer) {\n    toBind = events.pointer;\n  } else if (isMSPointer) {\n    toBind = events.MSPointer;\n  } else if (isTouch) {\n    toBind = events.touch;\n    secondBind = events.mouse;\n  } else {\n    toBind = events.mouse;\n  } ///////////////////////\n  ///      UTILS      ///\n  ///////////////////////\n\n\n  var u = {};\n\n  u.distance = function (p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  };\n\n  u.angle = function (p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n    return u.degrees(Math.atan2(dy, dx));\n  };\n\n  u.findCoord = function (p, d, a) {\n    var b = {\n      x: 0,\n      y: 0\n    };\n    a = u.radians(a);\n    b.x = p.x - d * Math.cos(a);\n    b.y = p.y - d * Math.sin(a);\n    return b;\n  };\n\n  u.radians = function (a) {\n    return a * (Math.PI / 180);\n  };\n\n  u.degrees = function (a) {\n    return a * (180 / Math.PI);\n  };\n\n  u.bindEvt = function (el, arg, handler) {\n    var types = arg.split(/[ ,]+/g);\n    var type;\n\n    for (var i = 0; i < types.length; i += 1) {\n      type = types[i];\n\n      if (el.addEventListener) {\n        el.addEventListener(type, handler, false);\n      } else if (el.attachEvent) {\n        el.attachEvent(type, handler);\n      }\n    }\n  };\n\n  u.unbindEvt = function (el, arg, handler) {\n    var types = arg.split(/[ ,]+/g);\n    var type;\n\n    for (var i = 0; i < types.length; i += 1) {\n      type = types[i];\n\n      if (el.removeEventListener) {\n        el.removeEventListener(type, handler);\n      } else if (el.detachEvent) {\n        el.detachEvent(type, handler);\n      }\n    }\n  };\n\n  u.trigger = function (el, type, data) {\n    var evt = new CustomEvent(type, data);\n    el.dispatchEvent(evt);\n  };\n\n  u.prepareEvent = function (evt) {\n    evt.preventDefault();\n    return evt.type.match(/^touch/) ? evt.changedTouches : evt;\n  };\n\n  u.getScroll = function () {\n    var x = window.pageXOffset !== undefined ? window.pageXOffset : (document.documentElement || document.body.parentNode || document.body).scrollLeft;\n    var y = window.pageYOffset !== undefined ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  u.applyPosition = function (el, pos) {\n    if (pos.top || pos.right || pos.bottom || pos.left) {\n      el.style.top = pos.top;\n      el.style.right = pos.right;\n      el.style.bottom = pos.bottom;\n      el.style.left = pos.left;\n    } else {\n      el.style.left = pos.x + 'px';\n      el.style.top = pos.y + 'px';\n    }\n  };\n\n  u.getTransitionStyle = function (property, values, time) {\n    var obj = u.configStylePropertyObject(property);\n\n    for (var i in obj) {\n      if (obj.hasOwnProperty(i)) {\n        if (typeof values === 'string') {\n          obj[i] = values + ' ' + time;\n        } else {\n          var st = '';\n\n          for (var j = 0, max = values.length; j < max; j += 1) {\n            st += values[j] + ' ' + time + ', ';\n          }\n\n          obj[i] = st.slice(0, -2);\n        }\n      }\n    }\n\n    return obj;\n  };\n\n  u.getVendorStyle = function (property, value) {\n    var obj = u.configStylePropertyObject(property);\n\n    for (var i in obj) {\n      if (obj.hasOwnProperty(i)) {\n        obj[i] = value;\n      }\n    }\n\n    return obj;\n  };\n\n  u.configStylePropertyObject = function (prop) {\n    var obj = {};\n    obj[prop] = '';\n    var vendors = ['webkit', 'Moz', 'o'];\n    vendors.forEach(function (vendor) {\n      obj[vendor + prop.charAt(0).toUpperCase() + prop.slice(1)] = '';\n    });\n    return obj;\n  };\n\n  u.extend = function (objA, objB) {\n    for (var i in objB) {\n      if (objB.hasOwnProperty(i)) {\n        objA[i] = objB[i];\n      }\n    }\n\n    return objA;\n  }; // Overwrite only what's already present\n\n\n  u.safeExtend = function (objA, objB) {\n    var obj = {};\n\n    for (var i in objA) {\n      if (objA.hasOwnProperty(i) && objB.hasOwnProperty(i)) {\n        obj[i] = objB[i];\n      } else if (objA.hasOwnProperty(i)) {\n        obj[i] = objA[i];\n      }\n    }\n\n    return obj;\n  }; // Map for array or unique item.\n\n\n  u.map = function (ar, fn) {\n    if (ar.length) {\n      for (var i = 0, max = ar.length; i < max; i += 1) {\n        fn(ar[i]);\n      }\n    } else {\n      fn(ar);\n    }\n  }; ///////////////////////\n  ///   SUPER CLASS   ///\n  ///////////////////////\n\n\n  function Super() {}\n\n  ; // Basic event system.\n\n  Super.prototype.on = function (arg, cb) {\n    var self = this;\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    self._handlers_ = self._handlers_ || {};\n\n    for (var i = 0; i < types.length; i += 1) {\n      type = types[i];\n      self._handlers_[type] = self._handlers_[type] || [];\n\n      self._handlers_[type].push(cb);\n    }\n\n    return self;\n  };\n\n  Super.prototype.off = function (type, cb) {\n    var self = this;\n    self._handlers_ = self._handlers_ || {};\n\n    if (type === undefined) {\n      self._handlers_ = {};\n    } else if (cb === undefined) {\n      self._handlers_[type] = null;\n    } else if (self._handlers_[type] && self._handlers_[type].indexOf(cb) >= 0) {\n      self._handlers_[type].splice(self._handlers_[type].indexOf(cb), 1);\n    }\n\n    return self;\n  };\n\n  Super.prototype.trigger = function (arg, data) {\n    var self = this;\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    self._handlers_ = self._handlers_ || {};\n\n    for (var i = 0; i < types.length; i += 1) {\n      type = types[i];\n\n      if (self._handlers_[type] && self._handlers_[type].length) {\n        self._handlers_[type].forEach(function (handler) {\n          handler.call(self, {\n            type: type,\n            target: self\n          }, data);\n        });\n      }\n    }\n  }; // Configuration\n\n\n  Super.prototype.config = function (options) {\n    var self = this;\n    self.options = self.defaults || {};\n\n    if (options) {\n      self.options = u.safeExtend(self.options, options);\n    }\n  }; // Bind internal events.\n\n\n  Super.prototype.bindEvt = function (el, type) {\n    var self = this;\n    self._domHandlers_ = self._domHandlers_ || {};\n\n    self._domHandlers_[type] = function () {\n      if (typeof self['on' + type] === 'function') {\n        self['on' + type].apply(self, arguments);\n      } else {\n        console.warn('[WARNING] : Missing \"on' + type + '\" handler.');\n      }\n    };\n\n    u.bindEvt(el, toBind[type], self._domHandlers_[type]);\n\n    if (secondBind[type]) {\n      // Support for both touch and mouse at the same time.\n      u.bindEvt(el, secondBind[type], self._domHandlers_[type]);\n    }\n\n    return self;\n  }; // Unbind dom events.\n\n\n  Super.prototype.unbindEvt = function (el, type) {\n    var self = this;\n    self._domHandlers_ = self._domHandlers_ || {};\n    u.unbindEvt(el, toBind[type], self._domHandlers_[type]);\n\n    if (secondBind[type]) {\n      // Support for both touch and mouse at the same time.\n      u.unbindEvt(el, secondBind[type], self._domHandlers_[type]);\n    }\n\n    delete self._domHandlers_[type];\n    return this;\n  }; ///////////////////////\n  ///   THE NIPPLE    ///\n  ///////////////////////\n\n\n  function Nipple(collection, options) {\n    this.identifier = options.identifier;\n    this.position = options.position;\n    this.frontPosition = options.frontPosition;\n    this.collection = collection; // Defaults\n\n    this.defaults = {\n      size: 100,\n      threshold: 0.1,\n      color: 'white',\n      fadeTime: 250,\n      dataOnly: false,\n      restJoystick: true,\n      restOpacity: 0.5,\n      mode: 'dynamic',\n      zone: document.body,\n      lockX: false,\n      lockY: false\n    };\n    this.config(options); // Overwrites\n\n    if (this.options.mode === 'dynamic') {\n      this.options.restOpacity = 0;\n    }\n\n    this.id = Nipple.id;\n    Nipple.id += 1;\n    this.buildEl().stylize(); // Nipple's API.\n\n    this.instance = {\n      el: this.ui.el,\n      on: this.on.bind(this),\n      off: this.off.bind(this),\n      show: this.show.bind(this),\n      hide: this.hide.bind(this),\n      add: this.addToDom.bind(this),\n      remove: this.removeFromDom.bind(this),\n      destroy: this.destroy.bind(this),\n      resetDirection: this.resetDirection.bind(this),\n      computeDirection: this.computeDirection.bind(this),\n      trigger: this.trigger.bind(this),\n      position: this.position,\n      frontPosition: this.frontPosition,\n      ui: this.ui,\n      identifier: this.identifier,\n      id: this.id,\n      options: this.options\n    };\n    return this.instance;\n  }\n\n  ;\n  Nipple.prototype = new Super();\n  Nipple.constructor = Nipple;\n  Nipple.id = 0; // Build the dom element of the Nipple instance.\n\n  Nipple.prototype.buildEl = function (options) {\n    this.ui = {};\n\n    if (this.options.dataOnly) {\n      return this;\n    }\n\n    this.ui.el = document.createElement('div');\n    this.ui.back = document.createElement('div');\n    this.ui.front = document.createElement('div');\n    this.ui.el.className = 'nipple collection_' + this.collection.id;\n    this.ui.back.className = 'back';\n    this.ui.front.className = 'front';\n    this.ui.el.setAttribute('id', 'nipple_' + this.collection.id + '_' + this.id);\n    this.ui.el.appendChild(this.ui.back);\n    this.ui.el.appendChild(this.ui.front);\n    return this;\n  }; // Apply CSS to the Nipple instance.\n\n\n  Nipple.prototype.stylize = function () {\n    if (this.options.dataOnly) {\n      return this;\n    }\n\n    var animTime = this.options.fadeTime + 'ms';\n    var borderStyle = u.getVendorStyle('borderRadius', '50%');\n    var transitStyle = u.getTransitionStyle('transition', 'opacity', animTime);\n    var styles = {};\n    styles.el = {\n      position: 'absolute',\n      opacity: this.options.restOpacity,\n      display: 'block',\n      'zIndex': 999\n    };\n    styles.back = {\n      position: 'absolute',\n      display: 'block',\n      width: this.options.size + 'px',\n      height: this.options.size + 'px',\n      marginLeft: -this.options.size / 2 + 'px',\n      marginTop: -this.options.size / 2 + 'px',\n      background: this.options.color,\n      'opacity': '.5'\n    };\n    styles.front = {\n      width: this.options.size / 2 + 'px',\n      height: this.options.size / 2 + 'px',\n      position: 'absolute',\n      display: 'block',\n      marginLeft: -this.options.size / 4 + 'px',\n      marginTop: -this.options.size / 4 + 'px',\n      background: this.options.color,\n      'opacity': '.5'\n    };\n    u.extend(styles.el, transitStyle);\n    u.extend(styles.back, borderStyle);\n    u.extend(styles.front, borderStyle);\n    this.applyStyles(styles);\n    return this;\n  };\n\n  Nipple.prototype.applyStyles = function (styles) {\n    // Apply styles\n    for (var i in this.ui) {\n      if (this.ui.hasOwnProperty(i)) {\n        for (var j in styles[i]) {\n          this.ui[i].style[j] = styles[i][j];\n        }\n      }\n    }\n\n    return this;\n  }; // Inject the Nipple instance into DOM.\n\n\n  Nipple.prototype.addToDom = function () {\n    // We're not adding it if we're dataOnly or already in dom.\n    if (this.options.dataOnly || document.body.contains(this.ui.el)) {\n      return this;\n    }\n\n    this.options.zone.appendChild(this.ui.el);\n    return this;\n  }; // Remove the Nipple instance from DOM.\n\n\n  Nipple.prototype.removeFromDom = function () {\n    if (this.options.dataOnly || !document.body.contains(this.ui.el)) {\n      return this;\n    }\n\n    this.options.zone.removeChild(this.ui.el);\n    return this;\n  }; // Entirely destroy this nipple\n\n\n  Nipple.prototype.destroy = function () {\n    clearTimeout(this.removeTimeout);\n    clearTimeout(this.showTimeout);\n    clearTimeout(this.restTimeout);\n    this.trigger('destroyed', this.instance);\n    this.removeFromDom();\n    this.off();\n  }; // Fade in the Nipple instance.\n\n\n  Nipple.prototype.show = function (cb) {\n    var self = this;\n\n    if (self.options.dataOnly) {\n      return self;\n    }\n\n    clearTimeout(self.removeTimeout);\n    clearTimeout(self.showTimeout);\n    clearTimeout(self.restTimeout);\n    self.addToDom();\n    self.restCallback();\n    setTimeout(function () {\n      self.ui.el.style.opacity = 1;\n    }, 0);\n    self.showTimeout = setTimeout(function () {\n      self.trigger('shown', self.instance);\n\n      if (typeof cb === 'function') {\n        cb.call(this);\n      }\n    }, self.options.fadeTime);\n    return self;\n  }; // Fade out the Nipple instance.\n\n\n  Nipple.prototype.hide = function (cb) {\n    var self = this;\n\n    if (self.options.dataOnly) {\n      return self;\n    }\n\n    self.ui.el.style.opacity = self.options.restOpacity;\n    clearTimeout(self.removeTimeout);\n    clearTimeout(self.showTimeout);\n    clearTimeout(self.restTimeout);\n    self.removeTimeout = setTimeout(function () {\n      var display = self.options.mode === 'dynamic' ? 'none' : 'block';\n      self.ui.el.style.display = display;\n\n      if (typeof cb === 'function') {\n        cb.call(self);\n      }\n\n      self.trigger('hidden', self.instance);\n    }, self.options.fadeTime);\n\n    if (self.options.restJoystick) {\n      self.restPosition();\n    }\n\n    return self;\n  };\n\n  Nipple.prototype.restPosition = function (cb) {\n    var self = this;\n    self.frontPosition = {\n      x: 0,\n      y: 0\n    };\n    var animTime = self.options.fadeTime + 'ms';\n    var transitStyle = {};\n    transitStyle.front = u.getTransitionStyle('transition', ['top', 'left'], animTime);\n    var styles = {\n      front: {}\n    };\n    styles.front = {\n      left: self.frontPosition.x + 'px',\n      top: self.frontPosition.y + 'px'\n    };\n    self.applyStyles(transitStyle);\n    self.applyStyles(styles);\n    self.restTimeout = setTimeout(function () {\n      if (typeof cb === 'function') {\n        cb.call(self);\n      }\n\n      self.restCallback();\n    }, self.options.fadeTime);\n  };\n\n  Nipple.prototype.restCallback = function () {\n    var self = this;\n    var transitStyle = {};\n    transitStyle.front = u.getTransitionStyle('transition', 'none', '');\n    self.applyStyles(transitStyle);\n    self.trigger('rested', self.instance);\n  };\n\n  Nipple.prototype.resetDirection = function () {\n    // Fully rebuild the object to let the iteration possible.\n    this.direction = {\n      x: false,\n      y: false,\n      angle: false\n    };\n  };\n\n  Nipple.prototype.computeDirection = function (obj) {\n    var rAngle = obj.angle.radian;\n    var angle45 = Math.PI / 4;\n    var angle90 = Math.PI / 2;\n    var direction, directionX, directionY; // Angular direction\n    //     \\  UP /\n    //      \\   /\n    // LEFT       RIGHT\n    //      /   \\\n    //     /DOWN \\\n    //\n\n    if (rAngle > angle45 && rAngle < angle45 * 3 && !obj.lockX) {\n      direction = 'up';\n    } else if (rAngle > -angle45 && rAngle <= angle45 && !obj.lockY) {\n      direction = 'left';\n    } else if (rAngle > -angle45 * 3 && rAngle <= -angle45 && !obj.lockX) {\n      direction = 'down';\n    } else if (!obj.lockY) {\n      direction = 'right';\n    } // Plain direction\n    //    UP                 |\n    // _______               | RIGHT\n    //                  LEFT |\n    //   DOWN                |\n\n\n    if (!obj.lockY) {\n      if (rAngle > -angle90 && rAngle < angle90) {\n        directionX = 'left';\n      } else {\n        directionX = 'right';\n      }\n    }\n\n    if (!obj.lockX) {\n      if (rAngle > 0) {\n        directionY = 'up';\n      } else {\n        directionY = 'down';\n      }\n    }\n\n    if (obj.force > this.options.threshold) {\n      var oldDirection = {};\n\n      for (var i in this.direction) {\n        if (this.direction.hasOwnProperty(i)) {\n          oldDirection[i] = this.direction[i];\n        }\n      }\n\n      var same = {};\n      this.direction = {\n        x: directionX,\n        y: directionY,\n        angle: direction\n      };\n      obj.direction = this.direction;\n\n      for (var i in oldDirection) {\n        if (oldDirection[i] === this.direction[i]) {\n          same[i] = true;\n        }\n      } // If all 3 directions are the same, we don't trigger anything.\n\n\n      if (same.x && same.y && same.angle) {\n        return obj;\n      }\n\n      if (!same.x || !same.y) {\n        this.trigger('plain', obj);\n      }\n\n      if (!same.x) {\n        this.trigger('plain:' + directionX, obj);\n      }\n\n      if (!same.y) {\n        this.trigger('plain:' + directionY, obj);\n      }\n\n      if (!same.angle) {\n        this.trigger('dir dir:' + direction, obj);\n      }\n    }\n\n    return obj;\n  };\n  /* global Nipple, Super */\n  ///////////////////////////\n  ///   THE COLLECTION    ///\n  ///////////////////////////\n\n\n  function Collection(manager, options) {\n    var self = this;\n    self.nipples = [];\n    self.idles = [];\n    self.actives = [];\n    self.ids = [];\n    self.pressureIntervals = {};\n    self.manager = manager;\n    self.id = Collection.id;\n    Collection.id += 1; // Defaults\n\n    self.defaults = {\n      zone: document.body,\n      multitouch: false,\n      maxNumberOfNipples: 10,\n      mode: 'dynamic',\n      position: {\n        top: 0,\n        left: 0\n      },\n      catchDistance: 200,\n      size: 100,\n      threshold: 0.1,\n      color: 'white',\n      fadeTime: 250,\n      dataOnly: false,\n      restJoystick: true,\n      restOpacity: 0.5,\n      lockX: false,\n      lockY: false\n    };\n    self.config(options); // Overwrites\n\n    if (self.options.mode === 'static' || self.options.mode === 'semi') {\n      self.options.multitouch = false;\n    }\n\n    if (!self.options.multitouch) {\n      self.options.maxNumberOfNipples = 1;\n    }\n\n    self.updateBox();\n    self.prepareNipples();\n    self.bindings();\n    self.begin();\n    return self.nipples;\n  }\n\n  Collection.prototype = new Super();\n  Collection.constructor = Collection;\n  Collection.id = 0;\n\n  Collection.prototype.prepareNipples = function () {\n    var self = this;\n    var nips = self.nipples; // Public API Preparation.\n\n    nips.on = self.on.bind(self);\n    nips.off = self.off.bind(self);\n    nips.options = self.options;\n    nips.destroy = self.destroy.bind(self);\n    nips.ids = self.ids;\n    nips.id = self.id;\n    nips.processOnMove = self.processOnMove.bind(self);\n    nips.processOnEnd = self.processOnEnd.bind(self);\n\n    nips.get = function (id) {\n      if (id === undefined) {\n        return nips[0];\n      }\n\n      for (var i = 0, max = nips.length; i < max; i += 1) {\n        if (nips[i].identifier === id) {\n          return nips[i];\n        }\n      }\n\n      return false;\n    };\n  };\n\n  Collection.prototype.bindings = function () {\n    var self = this; // Touch start event.\n\n    self.bindEvt(self.options.zone, 'start'); // Avoid native touch actions (scroll, zoom etc...) on the zone.\n\n    self.options.zone.style.touchAction = 'none';\n    self.options.zone.style.msTouchAction = 'none';\n  };\n\n  Collection.prototype.begin = function () {\n    var self = this;\n    var opts = self.options; // We place our static nipple\n    // if needed.\n\n    if (opts.mode === 'static') {\n      var nipple = self.createNipple(opts.position, self.manager.getIdentifier()); // Add it to the dom.\n\n      nipple.add(); // Store it in idles.\n\n      self.idles.push(nipple);\n    }\n  }; // Nipple Factory\n\n\n  Collection.prototype.createNipple = function (position, identifier) {\n    var self = this;\n    var scroll = u.getScroll();\n    var toPutOn = {};\n    var opts = self.options;\n\n    if (position.x && position.y) {\n      toPutOn = {\n        x: position.x - (scroll.x + self.box.left),\n        y: position.y - (scroll.y + self.box.top)\n      };\n    } else if (position.top || position.right || position.bottom || position.left) {\n      // We need to compute the position X / Y of the joystick.\n      var dumb = document.createElement('DIV');\n      dumb.style.display = 'hidden';\n      dumb.style.top = position.top;\n      dumb.style.right = position.right;\n      dumb.style.bottom = position.bottom;\n      dumb.style.left = position.left;\n      dumb.style.position = 'absolute';\n      opts.zone.appendChild(dumb);\n      var dumbBox = dumb.getBoundingClientRect();\n      opts.zone.removeChild(dumb);\n      toPutOn = position;\n      position = {\n        x: dumbBox.left + scroll.x,\n        y: dumbBox.top + scroll.y\n      };\n    }\n\n    var nipple = new Nipple(self, {\n      color: opts.color,\n      size: opts.size,\n      threshold: opts.threshold,\n      fadeTime: opts.fadeTime,\n      dataOnly: opts.dataOnly,\n      restJoystick: opts.restJoystick,\n      restOpacity: opts.restOpacity,\n      mode: opts.mode,\n      identifier: identifier,\n      position: position,\n      zone: opts.zone,\n      frontPosition: {\n        x: 0,\n        y: 0\n      }\n    });\n\n    if (!opts.dataOnly) {\n      u.applyPosition(nipple.ui.el, toPutOn);\n      u.applyPosition(nipple.ui.front, nipple.frontPosition);\n    }\n\n    self.nipples.push(nipple);\n    self.trigger('added ' + nipple.identifier + ':added', nipple);\n    self.manager.trigger('added ' + nipple.identifier + ':added', nipple);\n    self.bindNipple(nipple);\n    return nipple;\n  };\n\n  Collection.prototype.updateBox = function () {\n    var self = this;\n    self.box = self.options.zone.getBoundingClientRect();\n  };\n\n  Collection.prototype.bindNipple = function (nipple) {\n    var self = this;\n    var type; // Bubble up identified events.\n\n    var handler = function (evt, data) {\n      // Identify the event type with the nipple's id.\n      type = evt.type + ' ' + data.id + ':' + evt.type;\n      self.trigger(type, data);\n    }; // When it gets destroyed.\n\n\n    nipple.on('destroyed', self.onDestroyed.bind(self)); // Other events that will get bubbled up.\n\n    nipple.on('shown hidden rested dir plain', handler);\n    nipple.on('dir:up dir:right dir:down dir:left', handler);\n    nipple.on('plain:up plain:right plain:down plain:left', handler);\n  };\n\n  Collection.prototype.pressureFn = function (touch, nipple, identifier) {\n    var self = this;\n    var previousPressure = 0;\n    clearInterval(self.pressureIntervals[identifier]); // Create an interval that will read the pressure every 100ms\n\n    self.pressureIntervals[identifier] = setInterval(function () {\n      var pressure = touch.force || touch.pressure || touch.webkitForce || 0;\n\n      if (pressure !== previousPressure) {\n        nipple.trigger('pressure', pressure);\n        self.trigger('pressure ' + nipple.identifier + ':pressure', pressure);\n        previousPressure = pressure;\n      }\n    }.bind(self), 100);\n  };\n\n  Collection.prototype.onstart = function (evt) {\n    var self = this;\n    var opts = self.options;\n    evt = u.prepareEvent(evt); // Update the box position\n\n    self.updateBox();\n\n    var process = function (touch) {\n      // If we can create new nipples\n      // meaning we don't have more active nipples than we should.\n      if (self.actives.length < opts.maxNumberOfNipples) {\n        self.processOnStart(touch);\n      }\n    };\n\n    u.map(evt, process); // We ask upstream to bind the document\n    // on 'move' and 'end'\n\n    self.manager.bindDocument();\n    return false;\n  };\n\n  Collection.prototype.processOnStart = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var indexInIdles;\n    var identifier = self.manager.getIdentifier(evt);\n    var pressure = evt.force || evt.pressure || evt.webkitForce || 0;\n    var position = {\n      x: evt.pageX,\n      y: evt.pageY\n    };\n    var nipple = self.getOrCreate(identifier, position); // Update its touch identifier\n\n    if (nipple.identifier !== identifier) {\n      self.manager.removeIdentifier(nipple.identifier);\n    }\n\n    nipple.identifier = identifier;\n\n    var process = function (nip) {\n      // Trigger the start.\n      nip.trigger('start', nip);\n      self.trigger('start ' + nip.id + ':start', nip);\n      nip.show();\n\n      if (pressure > 0) {\n        self.pressureFn(evt, nip, nip.identifier);\n      } // Trigger the first move event.\n\n\n      self.processOnMove(evt);\n    }; // Transfer it from idles to actives.\n\n\n    if ((indexInIdles = self.idles.indexOf(nipple)) >= 0) {\n      self.idles.splice(indexInIdles, 1);\n    } // Store the nipple in the actives array\n\n\n    self.actives.push(nipple);\n    self.ids.push(nipple.identifier);\n\n    if (opts.mode !== 'semi') {\n      process(nipple);\n    } else {\n      // In semi we check the distance of the touch\n      // to decide if we have to reset the nipple\n      var distance = u.distance(position, nipple.position);\n\n      if (distance <= opts.catchDistance) {\n        process(nipple);\n      } else {\n        nipple.destroy();\n        self.processOnStart(evt);\n        return;\n      }\n    }\n\n    return nipple;\n  };\n\n  Collection.prototype.getOrCreate = function (identifier, position) {\n    var self = this;\n    var opts = self.options;\n    var nipple; // If we're in static or semi, we might already have an active.\n\n    if (/(semi|static)/.test(opts.mode)) {\n      // Get the active one.\n      // TODO: Multi-touche for semi and static will start here.\n      // Return the nearest one.\n      nipple = self.idles[0];\n\n      if (nipple) {\n        self.idles.splice(0, 1);\n        return nipple;\n      }\n\n      if (opts.mode === 'semi') {\n        // If we're in semi mode, we need to create one.\n        return self.createNipple(position, identifier);\n      }\n\n      console.warn('Coudln\\'t find the needed nipple.');\n      return false;\n    } // In dynamic, we create a new one.\n\n\n    nipple = self.createNipple(position, identifier);\n    return nipple;\n  };\n\n  Collection.prototype.processOnMove = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var identifier = self.manager.getIdentifier(evt);\n    var nipple = self.nipples.get(identifier);\n\n    if (!nipple) {\n      // This is here just for safety.\n      // It shouldn't happen.\n      console.error('Found zombie joystick with ID ' + identifier);\n      self.manager.removeIdentifier(identifier);\n      return;\n    }\n\n    nipple.identifier = identifier;\n    var size = nipple.options.size / 2;\n    var pos = {\n      x: evt.pageX,\n      y: evt.pageY\n    };\n    var dist = u.distance(pos, nipple.position);\n    var angle = u.angle(pos, nipple.position);\n    var rAngle = u.radians(angle);\n    var force = dist / size; // If distance is bigger than nipple's size\n    // we clamp the position.\n\n    if (dist > size) {\n      dist = size;\n      pos = u.findCoord(nipple.position, dist, angle);\n    }\n\n    var xPosition = pos.x - nipple.position.x;\n    var yPosition = pos.y - nipple.position.y;\n\n    if (opts.lockX) {\n      yPosition = 0;\n    }\n\n    if (opts.lockY) {\n      xPosition = 0;\n    }\n\n    nipple.frontPosition = {\n      x: xPosition,\n      y: yPosition\n    };\n\n    if (!opts.dataOnly) {\n      u.applyPosition(nipple.ui.front, nipple.frontPosition);\n    } // Prepare event's datas.\n\n\n    var toSend = {\n      identifier: nipple.identifier,\n      position: pos,\n      force: force,\n      pressure: evt.force || evt.pressure || evt.webkitForce || 0,\n      distance: dist,\n      angle: {\n        radian: rAngle,\n        degree: angle\n      },\n      instance: nipple,\n      lockX: opts.lockX,\n      lockY: opts.lockY\n    }; // Compute the direction's datas.\n\n    toSend = nipple.computeDirection(toSend); // Offset angles to follow units circle.\n\n    toSend.angle = {\n      radian: u.radians(180 - angle),\n      degree: 180 - angle\n    }; // Send everything to everyone.\n\n    nipple.trigger('move', toSend);\n    self.trigger('move ' + nipple.id + ':move', toSend);\n  };\n\n  Collection.prototype.processOnEnd = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var identifier = self.manager.getIdentifier(evt);\n    var nipple = self.nipples.get(identifier);\n    var removedIdentifier = self.manager.removeIdentifier(nipple.identifier);\n\n    if (!nipple) {\n      return;\n    }\n\n    if (!opts.dataOnly) {\n      nipple.hide(function () {\n        if (opts.mode === 'dynamic') {\n          nipple.trigger('removed', nipple);\n          self.trigger('removed ' + nipple.id + ':removed', nipple);\n          self.manager.trigger('removed ' + nipple.id + ':removed', nipple);\n          nipple.destroy();\n        }\n      });\n    } // Clear the pressure interval reader\n\n\n    clearInterval(self.pressureIntervals[nipple.identifier]); // Reset the direciton of the nipple, to be able to trigger a new direction\n    // on start.\n\n    nipple.resetDirection();\n    nipple.trigger('end', nipple);\n    self.trigger('end ' + nipple.id + ':end', nipple); // Remove identifier from our bank.\n\n    if (self.ids.indexOf(nipple.identifier) >= 0) {\n      self.ids.splice(self.ids.indexOf(nipple.identifier), 1);\n    } // Clean our actives array.\n\n\n    if (self.actives.indexOf(nipple) >= 0) {\n      self.actives.splice(self.actives.indexOf(nipple), 1);\n    }\n\n    if (/(semi|static)/.test(opts.mode)) {\n      // Transfer nipple from actives to idles\n      // if we're in semi or static mode.\n      self.idles.push(nipple);\n    } else if (self.nipples.indexOf(nipple) >= 0) {\n      // Only if we're not in semi or static mode\n      // we can remove the instance.\n      self.nipples.splice(self.nipples.indexOf(nipple), 1);\n    } // We unbind move and end.\n\n\n    self.manager.unbindDocument(); // We add back the identifier of the idle nipple;\n\n    if (/(semi|static)/.test(opts.mode)) {\n      self.manager.ids[removedIdentifier.id] = removedIdentifier.identifier;\n    }\n  }; // Remove destroyed nipple from the lists\n\n\n  Collection.prototype.onDestroyed = function (evt, nipple) {\n    var self = this;\n\n    if (self.nipples.indexOf(nipple) >= 0) {\n      self.nipples.splice(self.nipples.indexOf(nipple), 1);\n    }\n\n    if (self.actives.indexOf(nipple) >= 0) {\n      self.actives.splice(self.actives.indexOf(nipple), 1);\n    }\n\n    if (self.idles.indexOf(nipple) >= 0) {\n      self.idles.splice(self.idles.indexOf(nipple), 1);\n    }\n\n    if (self.ids.indexOf(nipple.identifier) >= 0) {\n      self.ids.splice(self.ids.indexOf(nipple.identifier), 1);\n    } // Remove the identifier from our bank\n\n\n    self.manager.removeIdentifier(nipple.identifier); // We unbind move and end.\n\n    self.manager.unbindDocument();\n  }; // Cleanly destroy the manager\n\n\n  Collection.prototype.destroy = function () {\n    var self = this;\n    self.unbindEvt(self.options.zone, 'start'); // Destroy nipples.\n\n    self.nipples.forEach(function (nipple) {\n      nipple.destroy();\n    }); // Clean 3DTouch intervals.\n\n    for (var i in self.pressureIntervals) {\n      if (self.pressureIntervals.hasOwnProperty(i)) {\n        clearInterval(self.pressureIntervals[i]);\n      }\n    } // Notify the manager passing the instance\n\n\n    self.trigger('destroyed', self.nipples); // We unbind move and end.\n\n    self.manager.unbindDocument(); // Unbind everything.\n\n    self.off();\n  };\n  /* global u, Super, Collection */\n  ///////////////////////\n  ///     MANAGER     ///\n  ///////////////////////\n\n\n  function Manager(options) {\n    var self = this;\n    self.ids = {};\n    self.index = 0;\n    self.collections = [];\n    self.config(options);\n    self.prepareCollections(); // Listen for resize, to reposition every joysticks\n\n    var resizeTimer;\n    u.bindEvt(window, 'resize', function (evt) {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(function () {\n        var pos;\n        var scroll = u.getScroll();\n        self.collections.forEach(function (collection) {\n          collection.forEach(function (nipple) {\n            pos = nipple.el.getBoundingClientRect();\n            nipple.position = {\n              x: scroll.x + pos.left,\n              y: scroll.y + pos.top\n            };\n          });\n        });\n      }, 100);\n    });\n    return self.collections;\n  }\n\n  ;\n  Manager.prototype = new Super();\n  Manager.constructor = Manager;\n\n  Manager.prototype.prepareCollections = function () {\n    var self = this; // Public API Preparation.\n\n    self.collections.create = self.create.bind(self); // Listen to anything\n\n    self.collections.on = self.on.bind(self); // Unbind general events\n\n    self.collections.off = self.off.bind(self); // Destroy everything\n\n    self.collections.destroy = self.destroy.bind(self); // Get any nipple\n\n    self.collections.get = function (id) {\n      var nipple;\n      self.collections.every(function (collection) {\n        if (nipple = collection.get(id)) {\n          return false;\n        }\n\n        return true;\n      });\n      return nipple;\n    };\n  };\n\n  Manager.prototype.create = function (options) {\n    return this.createCollection(options);\n  }; // Collection Factory\n\n\n  Manager.prototype.createCollection = function (options) {\n    var self = this;\n    var collection = new Collection(self, options);\n    self.bindCollection(collection);\n    self.collections.push(collection);\n    return collection;\n  };\n\n  Manager.prototype.bindCollection = function (collection) {\n    var self = this;\n    var type; // Bubble up identified events.\n\n    var handler = function (evt, data) {\n      // Identify the event type with the nipple's identifier.\n      type = evt.type + ' ' + data.id + ':' + evt.type;\n      self.trigger(type, data);\n    }; // When it gets destroyed we clean.\n\n\n    collection.on('destroyed', self.onDestroyed.bind(self)); // Other events that will get bubbled up.\n\n    collection.on('shown hidden rested dir plain', handler);\n    collection.on('dir:up dir:right dir:down dir:left', handler);\n    collection.on('plain:up plain:right plain:down plain:left', handler);\n  };\n\n  Manager.prototype.bindDocument = function () {\n    var self = this; // Bind only if not already binded\n\n    if (!self.binded) {\n      self.bindEvt(document, 'move').bindEvt(document, 'end');\n      self.binded = true;\n    }\n  };\n\n  Manager.prototype.unbindDocument = function (force) {\n    var self = this; // If there are no touch left\n    // unbind the document.\n\n    if (!Object.keys(self.ids).length || force === true) {\n      self.unbindEvt(document, 'move').unbindEvt(document, 'end');\n      self.binded = false;\n    }\n  };\n\n  Manager.prototype.getIdentifier = function (evt) {\n    var id; // If no event, simple increment\n\n    if (!evt) {\n      id = this.index;\n    } else {\n      // Extract identifier from event object.\n      // Unavailable in mouse events so replaced by latest increment.\n      id = evt.identifier === undefined ? evt.pointerId : evt.identifier;\n\n      if (id === undefined) {\n        id = this.latest || 0;\n      }\n    }\n\n    if (this.ids[id] === undefined) {\n      this.ids[id] = this.index;\n      this.index += 1;\n    } // Keep the latest id used in case we're using an unidentified mouseEvent\n\n\n    this.latest = id;\n    return this.ids[id];\n  };\n\n  Manager.prototype.removeIdentifier = function (identifier) {\n    var removed = {};\n\n    for (var id in this.ids) {\n      if (this.ids[id] === identifier) {\n        removed.id = id;\n        removed.identifier = this.ids[id];\n        delete this.ids[id];\n        break;\n      }\n    }\n\n    return removed;\n  };\n\n  Manager.prototype.onmove = function (evt) {\n    var self = this;\n    self.onAny('move', evt);\n    return false;\n  };\n\n  Manager.prototype.onend = function (evt) {\n    var self = this;\n    self.onAny('end', evt);\n    return false;\n  };\n\n  Manager.prototype.oncancel = function (evt) {\n    var self = this;\n    self.onAny('end', evt);\n    return false;\n  };\n\n  Manager.prototype.onAny = function (which, evt) {\n    var self = this;\n    var id;\n    var processFn = 'processOn' + which.charAt(0).toUpperCase() + which.slice(1);\n    evt = u.prepareEvent(evt);\n\n    var processColl = function (e, id, coll) {\n      if (coll.ids.indexOf(id) >= 0) {\n        coll[processFn](e); // Mark the event to avoid cleaning it later.\n\n        e._found_ = true;\n      }\n    };\n\n    var processEvt = function (e) {\n      id = self.getIdentifier(e);\n      u.map(self.collections, processColl.bind(null, e, id)); // If the event isn't handled by any collection,\n      // we need to clean its identifier.\n\n      if (!e._found_) {\n        self.removeIdentifier(id);\n      }\n    };\n\n    u.map(evt, processEvt);\n    return false;\n  }; // Cleanly destroy the manager\n\n\n  Manager.prototype.destroy = function () {\n    var self = this;\n    self.unbindDocument(true);\n    self.ids = {};\n    self.index = 0;\n    self.collections.forEach(function (collection) {\n      collection.destroy();\n    });\n    self.off();\n  }; // When a collection gets destroyed\n  // we clean behind.\n\n\n  Manager.prototype.onDestroyed = function (evt, coll) {\n    var self = this;\n\n    if (self.collections.indexOf(coll) < 0) {\n      return false;\n    }\n\n    self.collections.splice(self.collections.indexOf(coll), 1);\n  };\n\n  var factory = new Manager();\n  return {\n    create: function (options) {\n      return factory.create(options);\n    },\n    factory: factory\n  };\n});","map":{"version":3,"sources":["/home/alan/git/joystck-ros/node_modules/nipplejs/dist/nipplejs.js"],"names":["f","exports","module","define","amd","g","window","global","self","nipplejs","isTouch","isPointer","PointerEvent","isMSPointer","MSPointerEvent","events","touch","start","move","end","mouse","pointer","MSPointer","toBind","secondBind","u","distance","p1","p2","dx","x","dy","y","Math","sqrt","angle","degrees","atan2","findCoord","p","d","a","b","radians","cos","sin","PI","bindEvt","el","arg","handler","types","split","type","i","length","addEventListener","attachEvent","unbindEvt","removeEventListener","detachEvent","trigger","data","evt","CustomEvent","dispatchEvent","prepareEvent","preventDefault","match","changedTouches","getScroll","pageXOffset","undefined","document","documentElement","body","parentNode","scrollLeft","pageYOffset","scrollTop","applyPosition","pos","top","right","bottom","left","style","getTransitionStyle","property","values","time","obj","configStylePropertyObject","hasOwnProperty","st","j","max","slice","getVendorStyle","value","prop","vendors","forEach","vendor","charAt","toUpperCase","extend","objA","objB","safeExtend","map","ar","fn","Super","prototype","on","cb","_handlers_","push","off","indexOf","splice","call","target","config","options","defaults","_domHandlers_","apply","arguments","console","warn","Nipple","collection","identifier","position","frontPosition","size","threshold","color","fadeTime","dataOnly","restJoystick","restOpacity","mode","zone","lockX","lockY","id","buildEl","stylize","instance","ui","bind","show","hide","add","addToDom","remove","removeFromDom","destroy","resetDirection","computeDirection","constructor","createElement","back","front","className","setAttribute","appendChild","animTime","borderStyle","transitStyle","styles","opacity","display","width","height","marginLeft","marginTop","background","applyStyles","contains","removeChild","clearTimeout","removeTimeout","showTimeout","restTimeout","restCallback","setTimeout","restPosition","direction","rAngle","radian","angle45","angle90","directionX","directionY","force","oldDirection","same","Collection","manager","nipples","idles","actives","ids","pressureIntervals","multitouch","maxNumberOfNipples","catchDistance","updateBox","prepareNipples","bindings","begin","nips","processOnMove","processOnEnd","get","touchAction","msTouchAction","opts","nipple","createNipple","getIdentifier","scroll","toPutOn","box","dumb","dumbBox","getBoundingClientRect","bindNipple","onDestroyed","pressureFn","previousPressure","clearInterval","setInterval","pressure","webkitForce","onstart","process","processOnStart","bindDocument","indexInIdles","pageX","pageY","getOrCreate","removeIdentifier","nip","test","error","dist","xPosition","yPosition","toSend","degree","removedIdentifier","unbindDocument","Manager","index","collections","prepareCollections","resizeTimer","create","every","createCollection","bindCollection","binded","Object","keys","pointerId","latest","removed","onmove","onAny","onend","oncancel","which","processFn","processColl","e","coll","_found_","processEvt","factory"],"mappings":"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","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.nipplejs = f()}})(function(){var define,module,exports;\n'use strict';\n\n// Constants\nvar isTouch = !!('ontouchstart' in window);\nvar isPointer = window.PointerEvent ? true : false;\nvar isMSPointer = window.MSPointerEvent ? true : false;\nvar events = {\n    touch: {\n        start: 'touchstart',\n        move: 'touchmove',\n        end: 'touchend, touchcancel'\n    },\n    mouse: {\n        start: 'mousedown',\n        move: 'mousemove',\n        end: 'mouseup'\n    },\n    pointer: {\n        start: 'pointerdown',\n        move: 'pointermove',\n        end: 'pointerup, pointercancel'\n    },\n    MSPointer: {\n        start: 'MSPointerDown',\n        move: 'MSPointerMove',\n        end: 'MSPointerUp'\n    }\n};\nvar toBind;\nvar secondBind = {};\nif (isPointer) {\n    toBind = events.pointer;\n} else if (isMSPointer) {\n    toBind = events.MSPointer;\n} else if (isTouch) {\n    toBind = events.touch;\n    secondBind = events.mouse;\n} else {\n    toBind = events.mouse;\n}\n\n///////////////////////\n///      UTILS      ///\n///////////////////////\n\nvar u = {};\nu.distance = function (p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n\n    return Math.sqrt((dx * dx) + (dy * dy));\n};\n\nu.angle = function(p1, p2) {\n    var dx = p2.x - p1.x;\n    var dy = p2.y - p1.y;\n\n    return u.degrees(Math.atan2(dy, dx));\n};\n\nu.findCoord = function(p, d, a) {\n    var b = {x: 0, y: 0};\n    a = u.radians(a);\n    b.x = p.x - d * Math.cos(a);\n    b.y = p.y - d * Math.sin(a);\n    return b;\n};\n\nu.radians = function(a) {\n    return a * (Math.PI / 180);\n};\n\nu.degrees = function(a) {\n    return a * (180 / Math.PI);\n};\n\nu.bindEvt = function (el, arg, handler) {\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    for (var i = 0; i < types.length; i += 1) {\n        type = types[i];\n        if (el.addEventListener) {\n            el.addEventListener(type, handler, false);\n        } else if (el.attachEvent) {\n            el.attachEvent(type, handler);\n        }\n    }\n};\n\nu.unbindEvt = function (el, arg, handler) {\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    for (var i = 0; i < types.length; i += 1) {\n        type = types[i];\n        if (el.removeEventListener) {\n            el.removeEventListener(type, handler);\n        } else if (el.detachEvent) {\n            el.detachEvent(type, handler);\n        }\n    }\n};\n\nu.trigger = function (el, type, data) {\n    var evt = new CustomEvent(type, data);\n    el.dispatchEvent(evt);\n};\n\nu.prepareEvent = function (evt) {\n    evt.preventDefault();\n    return evt.type.match(/^touch/) ? evt.changedTouches : evt;\n};\n\nu.getScroll = function () {\n    var x = (window.pageXOffset !== undefined) ?\n        window.pageXOffset :\n        (document.documentElement || document.body.parentNode || document.body)\n            .scrollLeft;\n\n    var y = (window.pageYOffset !== undefined) ?\n        window.pageYOffset :\n        (document.documentElement || document.body.parentNode || document.body)\n            .scrollTop;\n    return {\n        x: x,\n        y: y\n    };\n};\n\nu.applyPosition = function (el, pos) {\n    if (pos.top || pos.right || pos.bottom || pos.left) {\n        el.style.top = pos.top;\n        el.style.right = pos.right;\n        el.style.bottom = pos.bottom;\n        el.style.left = pos.left;\n    } else {\n        el.style.left = pos.x + 'px';\n        el.style.top = pos.y + 'px';\n    }\n};\n\nu.getTransitionStyle = function (property, values, time) {\n    var obj = u.configStylePropertyObject(property);\n    for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (typeof values === 'string') {\n                obj[i] = values + ' ' + time;\n            } else {\n                var st = '';\n                for (var j = 0, max = values.length; j < max; j += 1) {\n                    st += values[j] + ' ' + time + ', ';\n                }\n                obj[i] = st.slice(0, -2);\n            }\n        }\n    }\n    return obj;\n};\n\nu.getVendorStyle = function (property, value) {\n    var obj = u.configStylePropertyObject(property);\n    for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            obj[i] = value;\n        }\n    }\n    return obj;\n};\n\nu.configStylePropertyObject = function (prop) {\n    var obj = {};\n    obj[prop] = '';\n    var vendors = ['webkit', 'Moz', 'o'];\n    vendors.forEach(function (vendor) {\n        obj[vendor + prop.charAt(0).toUpperCase() + prop.slice(1)] = '';\n    });\n    return obj;\n};\n\nu.extend = function (objA, objB) {\n    for (var i in objB) {\n        if (objB.hasOwnProperty(i)) {\n            objA[i] = objB[i];\n        }\n    }\n    return objA;\n};\n\n// Overwrite only what's already present\nu.safeExtend = function (objA, objB) {\n    var obj = {};\n    for (var i in objA) {\n        if (objA.hasOwnProperty(i) && objB.hasOwnProperty(i)) {\n            obj[i] = objB[i];\n        } else if (objA.hasOwnProperty(i)) {\n            obj[i] = objA[i];\n        }\n    }\n    return obj;\n};\n\n// Map for array or unique item.\nu.map = function (ar, fn) {\n    if (ar.length) {\n        for (var i = 0, max = ar.length; i < max; i += 1) {\n            fn(ar[i]);\n        }\n    } else {\n        fn(ar);\n    }\n};\n\n///////////////////////\n///   SUPER CLASS   ///\n///////////////////////\n\nfunction Super () {};\n\n// Basic event system.\nSuper.prototype.on = function (arg, cb) {\n    var self = this;\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    self._handlers_ = self._handlers_ || {};\n\n    for (var i = 0; i < types.length; i += 1) {\n        type = types[i];\n        self._handlers_[type] = self._handlers_[type] || [];\n        self._handlers_[type].push(cb);\n    }\n    return self;\n};\n\nSuper.prototype.off = function (type, cb) {\n    var self = this;\n    self._handlers_ = self._handlers_ || {};\n\n    if (type === undefined) {\n        self._handlers_ = {};\n    } else if (cb === undefined) {\n        self._handlers_[type] = null;\n    } else if (self._handlers_[type] &&\n            self._handlers_[type].indexOf(cb) >= 0) {\n        self._handlers_[type].splice(self._handlers_[type].indexOf(cb), 1);\n    }\n\n    return self;\n};\n\nSuper.prototype.trigger = function (arg, data) {\n    var self = this;\n    var types = arg.split(/[ ,]+/g);\n    var type;\n    self._handlers_ = self._handlers_ || {};\n\n    for (var i = 0; i < types.length; i += 1) {\n        type = types[i];\n        if (self._handlers_[type] && self._handlers_[type].length) {\n            self._handlers_[type].forEach(function (handler) {\n                handler.call(self, {\n                    type: type,\n                    target: self\n                }, data);\n            });\n        }\n    }\n};\n\n// Configuration\nSuper.prototype.config = function (options) {\n    var self = this;\n    self.options = self.defaults || {};\n    if (options) {\n        self.options = u.safeExtend(self.options, options);\n    }\n};\n\n// Bind internal events.\nSuper.prototype.bindEvt = function (el, type) {\n    var self = this;\n    self._domHandlers_ = self._domHandlers_ || {};\n\n    self._domHandlers_[type] = function () {\n        if (typeof self['on' + type] === 'function') {\n            self['on' + type].apply(self, arguments);\n        } else {\n            console.warn('[WARNING] : Missing \"on' + type + '\" handler.');\n        }\n    };\n\n    u.bindEvt(el, toBind[type], self._domHandlers_[type]);\n\n    if (secondBind[type]) {\n        // Support for both touch and mouse at the same time.\n        u.bindEvt(el, secondBind[type], self._domHandlers_[type]);\n    }\n\n    return self;\n};\n\n// Unbind dom events.\nSuper.prototype.unbindEvt = function (el, type) {\n    var self = this;\n    self._domHandlers_ = self._domHandlers_ || {};\n\n    u.unbindEvt(el, toBind[type], self._domHandlers_[type]);\n\n    if (secondBind[type]) {\n        // Support for both touch and mouse at the same time.\n        u.unbindEvt(el, secondBind[type], self._domHandlers_[type]);\n    }\n\n    delete self._domHandlers_[type];\n\n    return this;\n};\n\n///////////////////////\n///   THE NIPPLE    ///\n///////////////////////\n\nfunction Nipple (collection, options) {\n    this.identifier = options.identifier;\n    this.position = options.position;\n    this.frontPosition = options.frontPosition;\n    this.collection = collection;\n\n    // Defaults\n    this.defaults = {\n        size: 100,\n        threshold: 0.1,\n        color: 'white',\n        fadeTime: 250,\n        dataOnly: false,\n        restJoystick: true,\n        restOpacity: 0.5,\n        mode: 'dynamic',\n        zone: document.body,\n        lockX: false,\n        lockY: false\n    };\n\n    this.config(options);\n\n    // Overwrites\n    if (this.options.mode === 'dynamic') {\n        this.options.restOpacity = 0;\n    }\n\n    this.id = Nipple.id;\n    Nipple.id += 1;\n    this.buildEl()\n        .stylize();\n\n    // Nipple's API.\n    this.instance = {\n        el: this.ui.el,\n        on: this.on.bind(this),\n        off: this.off.bind(this),\n        show: this.show.bind(this),\n        hide: this.hide.bind(this),\n        add: this.addToDom.bind(this),\n        remove: this.removeFromDom.bind(this),\n        destroy: this.destroy.bind(this),\n        resetDirection: this.resetDirection.bind(this),\n        computeDirection: this.computeDirection.bind(this),\n        trigger: this.trigger.bind(this),\n        position: this.position,\n        frontPosition: this.frontPosition,\n        ui: this.ui,\n        identifier: this.identifier,\n        id: this.id,\n        options: this.options\n    };\n\n    return this.instance;\n};\n\nNipple.prototype = new Super();\nNipple.constructor = Nipple;\nNipple.id = 0;\n\n// Build the dom element of the Nipple instance.\nNipple.prototype.buildEl = function (options) {\n    this.ui = {};\n\n    if (this.options.dataOnly) {\n        return this;\n    }\n\n    this.ui.el = document.createElement('div');\n    this.ui.back = document.createElement('div');\n    this.ui.front = document.createElement('div');\n\n    this.ui.el.className = 'nipple collection_' + this.collection.id;\n    this.ui.back.className = 'back';\n    this.ui.front.className = 'front';\n\n    this.ui.el.setAttribute('id', 'nipple_' + this.collection.id +\n        '_' + this.id);\n\n    this.ui.el.appendChild(this.ui.back);\n    this.ui.el.appendChild(this.ui.front);\n\n    return this;\n};\n\n// Apply CSS to the Nipple instance.\nNipple.prototype.stylize = function () {\n    if (this.options.dataOnly) {\n        return this;\n    }\n    var animTime = this.options.fadeTime + 'ms';\n    var borderStyle = u.getVendorStyle('borderRadius', '50%');\n    var transitStyle = u.getTransitionStyle('transition', 'opacity', animTime);\n    var styles = {};\n    styles.el = {\n        position: 'absolute',\n        opacity: this.options.restOpacity,\n        display: 'block',\n        'zIndex': 999\n    };\n\n    styles.back = {\n        position: 'absolute',\n        display: 'block',\n        width: this.options.size + 'px',\n        height: this.options.size + 'px',\n        marginLeft: -this.options.size / 2 + 'px',\n        marginTop: -this.options.size / 2 + 'px',\n        background: this.options.color,\n        'opacity': '.5'\n    };\n\n    styles.front = {\n        width: this.options.size / 2 + 'px',\n        height: this.options.size / 2 + 'px',\n        position: 'absolute',\n        display: 'block',\n        marginLeft: -this.options.size / 4 + 'px',\n        marginTop: -this.options.size / 4 + 'px',\n        background: this.options.color,\n        'opacity': '.5'\n    };\n\n    u.extend(styles.el, transitStyle);\n    u.extend(styles.back, borderStyle);\n    u.extend(styles.front, borderStyle);\n\n    this.applyStyles(styles);\n\n    return this;\n};\n\nNipple.prototype.applyStyles = function (styles) {\n    // Apply styles\n    for (var i in this.ui) {\n        if (this.ui.hasOwnProperty(i)) {\n            for (var j in styles[i]) {\n                this.ui[i].style[j] = styles[i][j];\n            }\n        }\n    }\n\n    return this;\n};\n\n// Inject the Nipple instance into DOM.\nNipple.prototype.addToDom = function () {\n    // We're not adding it if we're dataOnly or already in dom.\n    if (this.options.dataOnly || document.body.contains(this.ui.el)) {\n        return this;\n    }\n    this.options.zone.appendChild(this.ui.el);\n    return this;\n};\n\n// Remove the Nipple instance from DOM.\nNipple.prototype.removeFromDom = function () {\n    if (this.options.dataOnly || !document.body.contains(this.ui.el)) {\n        return this;\n    }\n    this.options.zone.removeChild(this.ui.el);\n    return this;\n};\n\n// Entirely destroy this nipple\nNipple.prototype.destroy = function () {\n    clearTimeout(this.removeTimeout);\n    clearTimeout(this.showTimeout);\n    clearTimeout(this.restTimeout);\n    this.trigger('destroyed', this.instance);\n    this.removeFromDom();\n    this.off();\n};\n\n// Fade in the Nipple instance.\nNipple.prototype.show = function (cb) {\n    var self = this;\n\n    if (self.options.dataOnly) {\n        return self;\n    }\n\n    clearTimeout(self.removeTimeout);\n    clearTimeout(self.showTimeout);\n    clearTimeout(self.restTimeout);\n\n    self.addToDom();\n\n    self.restCallback();\n\n    setTimeout(function () {\n        self.ui.el.style.opacity = 1;\n    }, 0);\n\n    self.showTimeout = setTimeout(function () {\n        self.trigger('shown', self.instance);\n        if (typeof cb === 'function') {\n            cb.call(this);\n        }\n    }, self.options.fadeTime);\n\n    return self;\n};\n\n// Fade out the Nipple instance.\nNipple.prototype.hide = function (cb) {\n    var self = this;\n\n    if (self.options.dataOnly) {\n        return self;\n    }\n\n    self.ui.el.style.opacity = self.options.restOpacity;\n\n    clearTimeout(self.removeTimeout);\n    clearTimeout(self.showTimeout);\n    clearTimeout(self.restTimeout);\n\n    self.removeTimeout = setTimeout(\n        function () {\n            var display = self.options.mode === 'dynamic' ? 'none' : 'block';\n            self.ui.el.style.display = display;\n            if (typeof cb === 'function') {\n                cb.call(self);\n            }\n\n            self.trigger('hidden', self.instance);\n        },\n        self.options.fadeTime\n    );\n    if (self.options.restJoystick) {\n        self.restPosition();\n    }\n\n    return self;\n};\n\nNipple.prototype.restPosition = function (cb) {\n    var self = this;\n    self.frontPosition = {\n        x: 0,\n        y: 0\n    };\n    var animTime = self.options.fadeTime + 'ms';\n\n    var transitStyle = {};\n    transitStyle.front = u.getTransitionStyle('transition',\n        ['top', 'left'], animTime);\n\n    var styles = {front: {}};\n    styles.front = {\n        left: self.frontPosition.x + 'px',\n        top: self.frontPosition.y + 'px'\n    };\n\n    self.applyStyles(transitStyle);\n    self.applyStyles(styles);\n\n    self.restTimeout = setTimeout(\n        function () {\n            if (typeof cb === 'function') {\n                cb.call(self);\n            }\n            self.restCallback();\n        },\n        self.options.fadeTime\n    );\n};\n\nNipple.prototype.restCallback = function () {\n    var self = this;\n    var transitStyle = {};\n    transitStyle.front = u.getTransitionStyle('transition', 'none', '');\n    self.applyStyles(transitStyle);\n    self.trigger('rested', self.instance);\n};\n\nNipple.prototype.resetDirection = function () {\n    // Fully rebuild the object to let the iteration possible.\n    this.direction = {\n        x: false,\n        y: false,\n        angle: false\n    };\n};\n\nNipple.prototype.computeDirection = function (obj) {\n    var rAngle = obj.angle.radian;\n    var angle45 = Math.PI / 4;\n    var angle90 = Math.PI / 2;\n    var direction, directionX, directionY;\n\n    // Angular direction\n    //     \\  UP /\n    //      \\   /\n    // LEFT       RIGHT\n    //      /   \\\n    //     /DOWN \\\n    //\n    if (\n        rAngle > angle45 &&\n        rAngle < (angle45 * 3) &&\n        !obj.lockX\n    ) {\n        direction = 'up';\n    } else if (\n        rAngle > -angle45 &&\n        rAngle <= angle45 &&\n        !obj.lockY\n    ) {\n        direction = 'left';\n    } else if (\n        rAngle > (-angle45 * 3) &&\n        rAngle <= -angle45 &&\n        !obj.lockX\n    ) {\n        direction = 'down';\n    } else if (!obj.lockY) {\n        direction = 'right';\n    }\n\n    // Plain direction\n    //    UP                 |\n    // _______               | RIGHT\n    //                  LEFT |\n    //   DOWN                |\n    if (!obj.lockY) {\n        if (rAngle > -angle90 && rAngle < angle90) {\n            directionX = 'left';\n        } else {\n            directionX = 'right';\n        }\n    }\n\n    if (!obj.lockX) {\n        if (rAngle > 0) {\n            directionY = 'up';\n        } else {\n            directionY = 'down';\n        }\n    }\n\n    if (obj.force > this.options.threshold) {\n        var oldDirection = {};\n        for (var i in this.direction) {\n            if (this.direction.hasOwnProperty(i)) {\n                oldDirection[i] = this.direction[i];\n            }\n        }\n\n        var same = {};\n\n        this.direction = {\n            x: directionX,\n            y: directionY,\n            angle: direction\n        };\n\n        obj.direction = this.direction;\n\n        for (var i in oldDirection) {\n            if (oldDirection[i] === this.direction[i]) {\n                same[i] = true;\n            }\n        }\n\n        // If all 3 directions are the same, we don't trigger anything.\n        if (same.x && same.y && same.angle) {\n            return obj;\n        }\n\n        if (!same.x || !same.y) {\n            this.trigger('plain', obj);\n        }\n\n        if (!same.x) {\n            this.trigger('plain:' + directionX, obj);\n        }\n\n        if (!same.y) {\n            this.trigger('plain:' + directionY, obj);\n        }\n\n        if (!same.angle) {\n            this.trigger('dir dir:' + direction, obj);\n        }\n    }\n    return obj;\n};\n\n/* global Nipple, Super */\n\n///////////////////////////\n///   THE COLLECTION    ///\n///////////////////////////\n\nfunction Collection (manager, options) {\n    var self = this;\n    self.nipples = [];\n    self.idles = [];\n    self.actives = [];\n    self.ids = [];\n    self.pressureIntervals = {};\n    self.manager = manager;\n    self.id = Collection.id;\n    Collection.id += 1;\n\n    // Defaults\n    self.defaults = {\n        zone: document.body,\n        multitouch: false,\n        maxNumberOfNipples: 10,\n        mode: 'dynamic',\n        position: {top: 0, left: 0},\n        catchDistance: 200,\n        size: 100,\n        threshold: 0.1,\n        color: 'white',\n        fadeTime: 250,\n        dataOnly: false,\n        restJoystick: true,\n        restOpacity: 0.5,\n        lockX: false,\n        lockY: false\n    };\n\n    self.config(options);\n\n    // Overwrites\n    if (self.options.mode === 'static' || self.options.mode === 'semi') {\n        self.options.multitouch = false;\n    }\n\n    if (!self.options.multitouch) {\n        self.options.maxNumberOfNipples = 1;\n    }\n\n    self.updateBox();\n    self.prepareNipples();\n    self.bindings();\n    self.begin();\n\n    return self.nipples;\n}\n\nCollection.prototype = new Super();\nCollection.constructor = Collection;\nCollection.id = 0;\n\nCollection.prototype.prepareNipples = function () {\n    var self = this;\n    var nips = self.nipples;\n\n    // Public API Preparation.\n    nips.on = self.on.bind(self);\n    nips.off = self.off.bind(self);\n    nips.options = self.options;\n    nips.destroy = self.destroy.bind(self);\n    nips.ids = self.ids;\n    nips.id = self.id;\n    nips.processOnMove = self.processOnMove.bind(self);\n    nips.processOnEnd = self.processOnEnd.bind(self);\n    nips.get = function (id) {\n        if (id === undefined) {\n            return nips[0];\n        }\n        for (var i = 0, max = nips.length; i < max; i += 1) {\n            if (nips[i].identifier === id) {\n                return nips[i];\n            }\n        }\n        return false;\n    };\n};\n\nCollection.prototype.bindings = function () {\n    var self = this;\n    // Touch start event.\n    self.bindEvt(self.options.zone, 'start');\n    // Avoid native touch actions (scroll, zoom etc...) on the zone.\n    self.options.zone.style.touchAction = 'none';\n    self.options.zone.style.msTouchAction = 'none';\n};\n\nCollection.prototype.begin = function () {\n    var self = this;\n    var opts = self.options;\n\n    // We place our static nipple\n    // if needed.\n    if (opts.mode === 'static') {\n        var nipple = self.createNipple(\n            opts.position,\n            self.manager.getIdentifier()\n        );\n        // Add it to the dom.\n        nipple.add();\n        // Store it in idles.\n        self.idles.push(nipple);\n    }\n};\n\n// Nipple Factory\nCollection.prototype.createNipple = function (position, identifier) {\n    var self = this;\n    var scroll = u.getScroll();\n    var toPutOn = {};\n    var opts = self.options;\n\n    if (position.x && position.y) {\n        toPutOn = {\n            x: position.x -\n                (scroll.x + self.box.left),\n            y: position.y -\n                (scroll.y + self.box.top)\n        };\n    } else if (\n            position.top ||\n            position.right ||\n            position.bottom ||\n            position.left\n        ) {\n\n        // We need to compute the position X / Y of the joystick.\n        var dumb = document.createElement('DIV');\n        dumb.style.display = 'hidden';\n        dumb.style.top = position.top;\n        dumb.style.right = position.right;\n        dumb.style.bottom = position.bottom;\n        dumb.style.left = position.left;\n        dumb.style.position = 'absolute';\n\n        opts.zone.appendChild(dumb);\n        var dumbBox = dumb.getBoundingClientRect();\n        opts.zone.removeChild(dumb);\n\n        toPutOn = position;\n        position = {\n            x: dumbBox.left + scroll.x,\n            y: dumbBox.top + scroll.y\n        };\n    }\n\n    var nipple = new Nipple(self, {\n        color: opts.color,\n        size: opts.size,\n        threshold: opts.threshold,\n        fadeTime: opts.fadeTime,\n        dataOnly: opts.dataOnly,\n        restJoystick: opts.restJoystick,\n        restOpacity: opts.restOpacity,\n        mode: opts.mode,\n        identifier: identifier,\n        position: position,\n        zone: opts.zone,\n        frontPosition: {\n            x: 0,\n            y: 0\n        }\n    });\n\n    if (!opts.dataOnly) {\n        u.applyPosition(nipple.ui.el, toPutOn);\n        u.applyPosition(nipple.ui.front, nipple.frontPosition);\n    }\n    self.nipples.push(nipple);\n    self.trigger('added ' + nipple.identifier + ':added', nipple);\n    self.manager.trigger('added ' + nipple.identifier + ':added', nipple);\n\n    self.bindNipple(nipple);\n\n    return nipple;\n};\n\nCollection.prototype.updateBox = function () {\n    var self = this;\n    self.box = self.options.zone.getBoundingClientRect();\n};\n\nCollection.prototype.bindNipple = function (nipple) {\n    var self = this;\n    var type;\n    // Bubble up identified events.\n    var handler = function (evt, data) {\n        // Identify the event type with the nipple's id.\n        type = evt.type + ' ' + data.id + ':' + evt.type;\n        self.trigger(type, data);\n    };\n\n    // When it gets destroyed.\n    nipple.on('destroyed', self.onDestroyed.bind(self));\n\n    // Other events that will get bubbled up.\n    nipple.on('shown hidden rested dir plain', handler);\n    nipple.on('dir:up dir:right dir:down dir:left', handler);\n    nipple.on('plain:up plain:right plain:down plain:left', handler);\n};\n\nCollection.prototype.pressureFn = function (touch, nipple, identifier) {\n    var self = this;\n    var previousPressure = 0;\n    clearInterval(self.pressureIntervals[identifier]);\n    // Create an interval that will read the pressure every 100ms\n    self.pressureIntervals[identifier] = setInterval(function () {\n        var pressure = touch.force || touch.pressure ||\n            touch.webkitForce || 0;\n        if (pressure !== previousPressure) {\n            nipple.trigger('pressure', pressure);\n            self.trigger('pressure ' +\n                nipple.identifier + ':pressure', pressure);\n            previousPressure = pressure;\n        }\n    }.bind(self), 100);\n};\n\nCollection.prototype.onstart = function (evt) {\n    var self = this;\n    var opts = self.options;\n    evt = u.prepareEvent(evt);\n\n    // Update the box position\n    self.updateBox();\n\n    var process = function (touch) {\n        // If we can create new nipples\n        // meaning we don't have more active nipples than we should.\n        if (self.actives.length < opts.maxNumberOfNipples) {\n            self.processOnStart(touch);\n        }\n    };\n\n    u.map(evt, process);\n\n    // We ask upstream to bind the document\n    // on 'move' and 'end'\n    self.manager.bindDocument();\n    return false;\n};\n\nCollection.prototype.processOnStart = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var indexInIdles;\n    var identifier = self.manager.getIdentifier(evt);\n    var pressure = evt.force || evt.pressure || evt.webkitForce || 0;\n    var position = {\n        x: evt.pageX,\n        y: evt.pageY\n    };\n\n    var nipple = self.getOrCreate(identifier, position);\n\n    // Update its touch identifier\n    if (nipple.identifier !== identifier) {\n        self.manager.removeIdentifier(nipple.identifier);\n    }\n    nipple.identifier = identifier;\n\n    var process = function (nip) {\n        // Trigger the start.\n        nip.trigger('start', nip);\n        self.trigger('start ' + nip.id + ':start', nip);\n\n        nip.show();\n        if (pressure > 0) {\n            self.pressureFn(evt, nip, nip.identifier);\n        }\n        // Trigger the first move event.\n        self.processOnMove(evt);\n    };\n\n    // Transfer it from idles to actives.\n    if ((indexInIdles = self.idles.indexOf(nipple)) >= 0) {\n        self.idles.splice(indexInIdles, 1);\n    }\n\n    // Store the nipple in the actives array\n    self.actives.push(nipple);\n    self.ids.push(nipple.identifier);\n\n    if (opts.mode !== 'semi') {\n        process(nipple);\n    } else {\n        // In semi we check the distance of the touch\n        // to decide if we have to reset the nipple\n        var distance = u.distance(position, nipple.position);\n        if (distance <= opts.catchDistance) {\n            process(nipple);\n        } else {\n            nipple.destroy();\n            self.processOnStart(evt);\n            return;\n        }\n    }\n\n    return nipple;\n};\n\nCollection.prototype.getOrCreate = function (identifier, position) {\n    var self = this;\n    var opts = self.options;\n    var nipple;\n\n    // If we're in static or semi, we might already have an active.\n    if (/(semi|static)/.test(opts.mode)) {\n        // Get the active one.\n        // TODO: Multi-touche for semi and static will start here.\n        // Return the nearest one.\n        nipple = self.idles[0];\n        if (nipple) {\n            self.idles.splice(0, 1);\n            return nipple;\n        }\n\n        if (opts.mode === 'semi') {\n            // If we're in semi mode, we need to create one.\n            return self.createNipple(position, identifier);\n        }\n\n        console.warn('Coudln\\'t find the needed nipple.');\n        return false;\n    }\n    // In dynamic, we create a new one.\n    nipple = self.createNipple(position, identifier);\n    return nipple;\n};\n\nCollection.prototype.processOnMove = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var identifier = self.manager.getIdentifier(evt);\n    var nipple = self.nipples.get(identifier);\n\n    if (!nipple) {\n        // This is here just for safety.\n        // It shouldn't happen.\n        console.error('Found zombie joystick with ID ' + identifier);\n        self.manager.removeIdentifier(identifier);\n        return;\n    }\n\n    nipple.identifier = identifier;\n\n    var size = nipple.options.size / 2;\n    var pos = {\n        x: evt.pageX,\n        y: evt.pageY\n    };\n\n    var dist = u.distance(pos, nipple.position);\n    var angle = u.angle(pos, nipple.position);\n    var rAngle = u.radians(angle);\n    var force = dist / size;\n\n    // If distance is bigger than nipple's size\n    // we clamp the position.\n    if (dist > size) {\n        dist = size;\n        pos = u.findCoord(nipple.position, dist, angle);\n    }\n\n    var xPosition = pos.x - nipple.position.x\n    var yPosition = pos.y - nipple.position.y\n\n    if (opts.lockX){\n        yPosition = 0\n    }\n    if (opts.lockY) {\n        xPosition = 0\n    }\n\n    nipple.frontPosition = {\n        x: xPosition,\n        y: yPosition\n    };\n\n    if (!opts.dataOnly) {\n        u.applyPosition(nipple.ui.front, nipple.frontPosition);\n    }\n\n    // Prepare event's datas.\n    var toSend = {\n        identifier: nipple.identifier,\n        position: pos,\n        force: force,\n        pressure: evt.force || evt.pressure || evt.webkitForce || 0,\n        distance: dist,\n        angle: {\n            radian: rAngle,\n            degree: angle\n        },\n        instance: nipple,\n        lockX: opts.lockX,\n        lockY: opts.lockY\n    };\n\n    // Compute the direction's datas.\n    toSend = nipple.computeDirection(toSend);\n\n    // Offset angles to follow units circle.\n    toSend.angle = {\n        radian: u.radians(180 - angle),\n        degree: 180 - angle\n    };\n\n    // Send everything to everyone.\n    nipple.trigger('move', toSend);\n    self.trigger('move ' + nipple.id + ':move', toSend);\n};\n\nCollection.prototype.processOnEnd = function (evt) {\n    var self = this;\n    var opts = self.options;\n    var identifier = self.manager.getIdentifier(evt);\n    var nipple = self.nipples.get(identifier);\n    var removedIdentifier = self.manager.removeIdentifier(nipple.identifier);\n\n    if (!nipple) {\n        return;\n    }\n\n    if (!opts.dataOnly) {\n        nipple.hide(function () {\n            if (opts.mode === 'dynamic') {\n                nipple.trigger('removed', nipple);\n                self.trigger('removed ' + nipple.id + ':removed', nipple);\n                self.manager\n                    .trigger('removed ' + nipple.id + ':removed', nipple);\n                nipple.destroy();\n            }\n        });\n    }\n\n    // Clear the pressure interval reader\n    clearInterval(self.pressureIntervals[nipple.identifier]);\n\n    // Reset the direciton of the nipple, to be able to trigger a new direction\n    // on start.\n    nipple.resetDirection();\n\n    nipple.trigger('end', nipple);\n    self.trigger('end ' + nipple.id + ':end', nipple);\n\n    // Remove identifier from our bank.\n    if (self.ids.indexOf(nipple.identifier) >= 0) {\n        self.ids.splice(self.ids.indexOf(nipple.identifier), 1);\n    }\n\n    // Clean our actives array.\n    if (self.actives.indexOf(nipple) >= 0) {\n        self.actives.splice(self.actives.indexOf(nipple), 1);\n    }\n\n    if (/(semi|static)/.test(opts.mode)) {\n        // Transfer nipple from actives to idles\n        // if we're in semi or static mode.\n        self.idles.push(nipple);\n    } else if (self.nipples.indexOf(nipple) >= 0) {\n        // Only if we're not in semi or static mode\n        // we can remove the instance.\n        self.nipples.splice(self.nipples.indexOf(nipple), 1);\n    }\n\n    // We unbind move and end.\n    self.manager.unbindDocument();\n\n    // We add back the identifier of the idle nipple;\n    if (/(semi|static)/.test(opts.mode)) {\n        self.manager.ids[removedIdentifier.id] = removedIdentifier.identifier;\n    }\n};\n\n// Remove destroyed nipple from the lists\nCollection.prototype.onDestroyed = function(evt, nipple) {\n    var self = this;\n    if (self.nipples.indexOf(nipple) >= 0) {\n        self.nipples.splice(self.nipples.indexOf(nipple), 1);\n    }\n    if (self.actives.indexOf(nipple) >= 0) {\n        self.actives.splice(self.actives.indexOf(nipple), 1);\n    }\n    if (self.idles.indexOf(nipple) >= 0) {\n        self.idles.splice(self.idles.indexOf(nipple), 1);\n    }\n    if (self.ids.indexOf(nipple.identifier) >= 0) {\n        self.ids.splice(self.ids.indexOf(nipple.identifier), 1);\n    }\n\n    // Remove the identifier from our bank\n    self.manager.removeIdentifier(nipple.identifier);\n\n    // We unbind move and end.\n    self.manager.unbindDocument();\n};\n\n// Cleanly destroy the manager\nCollection.prototype.destroy = function () {\n    var self = this;\n    self.unbindEvt(self.options.zone, 'start');\n\n    // Destroy nipples.\n    self.nipples.forEach(function(nipple) {\n        nipple.destroy();\n    });\n\n    // Clean 3DTouch intervals.\n    for (var i in self.pressureIntervals) {\n        if (self.pressureIntervals.hasOwnProperty(i)) {\n            clearInterval(self.pressureIntervals[i]);\n        }\n    }\n\n    // Notify the manager passing the instance\n    self.trigger('destroyed', self.nipples);\n    // We unbind move and end.\n    self.manager.unbindDocument();\n    // Unbind everything.\n    self.off();\n};\n\n/* global u, Super, Collection */\n\n///////////////////////\n///     MANAGER     ///\n///////////////////////\n\nfunction Manager (options) {\n    var self = this;\n    self.ids = {};\n    self.index = 0;\n    self.collections = [];\n\n    self.config(options);\n    self.prepareCollections();\n\n    // Listen for resize, to reposition every joysticks\n    var resizeTimer;\n    u.bindEvt(window, 'resize', function (evt) {\n        clearTimeout(resizeTimer);\n        resizeTimer = setTimeout(function () {\n            var pos;\n            var scroll = u.getScroll();\n            self.collections.forEach(function (collection) {\n                collection.forEach(function (nipple) {\n                    pos = nipple.el.getBoundingClientRect();\n                    nipple.position = {\n                        x: scroll.x + pos.left,\n                        y: scroll.y + pos.top\n                    };\n                });\n            });\n        }, 100);\n    });\n\n    return self.collections;\n};\n\nManager.prototype = new Super();\nManager.constructor = Manager;\n\nManager.prototype.prepareCollections = function () {\n    var self = this;\n    // Public API Preparation.\n    self.collections.create = self.create.bind(self);\n    // Listen to anything\n    self.collections.on = self.on.bind(self);\n    // Unbind general events\n    self.collections.off = self.off.bind(self);\n    // Destroy everything\n    self.collections.destroy = self.destroy.bind(self);\n    // Get any nipple\n    self.collections.get = function (id) {\n        var nipple;\n        self.collections.every(function (collection) {\n            if (nipple = collection.get(id)) {\n                return false;\n            }\n            return true;\n        });\n        return nipple;\n    };\n};\n\nManager.prototype.create = function (options) {\n    return this.createCollection(options);\n};\n\n// Collection Factory\nManager.prototype.createCollection = function (options) {\n    var self = this;\n    var collection = new Collection(self, options);\n\n    self.bindCollection(collection);\n    self.collections.push(collection);\n\n    return collection;\n};\n\nManager.prototype.bindCollection = function (collection) {\n    var self = this;\n    var type;\n    // Bubble up identified events.\n    var handler = function (evt, data) {\n        // Identify the event type with the nipple's identifier.\n        type = evt.type + ' ' + data.id + ':' + evt.type;\n        self.trigger(type, data);\n    };\n\n    // When it gets destroyed we clean.\n    collection.on('destroyed', self.onDestroyed.bind(self));\n\n    // Other events that will get bubbled up.\n    collection.on('shown hidden rested dir plain', handler);\n    collection.on('dir:up dir:right dir:down dir:left', handler);\n    collection.on('plain:up plain:right plain:down plain:left', handler);\n};\n\nManager.prototype.bindDocument = function () {\n    var self = this;\n    // Bind only if not already binded\n    if (!self.binded) {\n        self.bindEvt(document, 'move')\n            .bindEvt(document, 'end');\n        self.binded = true;\n    }\n};\n\nManager.prototype.unbindDocument = function (force) {\n    var self = this;\n    // If there are no touch left\n    // unbind the document.\n    if (!Object.keys(self.ids).length || force === true) {\n        self.unbindEvt(document, 'move')\n            .unbindEvt(document, 'end');\n        self.binded = false;\n    }\n};\n\nManager.prototype.getIdentifier = function (evt) {\n    var id;\n    // If no event, simple increment\n    if (!evt) {\n        id = this.index;\n    } else {\n        // Extract identifier from event object.\n        // Unavailable in mouse events so replaced by latest increment.\n        id = evt.identifier === undefined ? evt.pointerId : evt.identifier;\n        if (id === undefined) {\n            id = this.latest || 0;\n        }\n    }\n\n    if (this.ids[id] === undefined) {\n        this.ids[id] = this.index;\n        this.index += 1;\n    }\n\n    // Keep the latest id used in case we're using an unidentified mouseEvent\n    this.latest = id;\n    return this.ids[id];\n};\n\nManager.prototype.removeIdentifier = function (identifier) {\n    var removed = {};\n    for (var id in this.ids) {\n        if (this.ids[id] === identifier) {\n            removed.id = id;\n            removed.identifier = this.ids[id];\n            delete this.ids[id];\n            break;\n        }\n    }\n    return removed;\n};\n\nManager.prototype.onmove = function (evt) {\n    var self = this;\n    self.onAny('move', evt);\n    return false;\n};\n\nManager.prototype.onend = function (evt) {\n    var self = this;\n    self.onAny('end', evt);\n    return false;\n};\n\nManager.prototype.oncancel = function (evt) {\n    var self = this;\n    self.onAny('end', evt);\n    return false;\n};\n\nManager.prototype.onAny = function (which, evt) {\n    var self = this;\n    var id;\n    var processFn = 'processOn' + which.charAt(0).toUpperCase() +\n        which.slice(1);\n    evt = u.prepareEvent(evt);\n    var processColl = function (e, id, coll) {\n        if (coll.ids.indexOf(id) >= 0) {\n            coll[processFn](e);\n            // Mark the event to avoid cleaning it later.\n            e._found_ = true;\n        }\n    };\n    var processEvt = function (e) {\n        id = self.getIdentifier(e);\n        u.map(self.collections, processColl.bind(null, e, id));\n        // If the event isn't handled by any collection,\n        // we need to clean its identifier.\n        if (!e._found_) {\n            self.removeIdentifier(id);\n        }\n    };\n\n    u.map(evt, processEvt);\n\n    return false;\n};\n\n// Cleanly destroy the manager\nManager.prototype.destroy = function () {\n    var self = this;\n    self.unbindDocument(true);\n    self.ids = {};\n    self.index = 0;\n    self.collections.forEach(function(collection) {\n        collection.destroy();\n    });\n    self.off();\n};\n\n// When a collection gets destroyed\n// we clean behind.\nManager.prototype.onDestroyed = function (evt, coll) {\n    var self = this;\n    if (self.collections.indexOf(coll) < 0) {\n        return false;\n    }\n    self.collections.splice(self.collections.indexOf(coll), 1);\n};\n\nvar factory = new Manager();\nreturn {\n    create: function (options) {\n        return factory.create(options);\n    },\n    factory: factory\n};\n\n});\n"]},"metadata":{},"sourceType":"script"}