{"ast":null,"code":"var _jsxFileName = \"/home/alan/git/joystck-ros/src/Components/Joystck.js\";\nimport React, { Component } from 'react';\nimport ReactNipple from 'react-nipple';\nimport ROSLIB from 'roslib';\nimport Config from \"./config\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Joystck extends Component {\n  constructor() {\n    super();\n    this.state = {\n      ros: null,\n      cmdVelPublisher: null,\n      linear: 0,\n      angular: 0,\n      stopPub: false\n    };\n    this.init_connection();\n    this.move = this.move.bind(this);\n    this.moveAction = this.moveAction.bind(this);\n  }\n\n  init_connection() {\n    // eslint-disable-next-line\n    this.state.ros = new ROSLIB.Ros();\n    this.state.ros.on(\"connection\", () => {\n      console.info(\"Connected to ROS:TELEOP\");\n    });\n    this.state.ros.on(\"close\", () => {\n      console.warn(\"Disconnected from ROS:TELEOP\");\n      setTimeout(() => {\n        try {\n          this.state.ros.connect(\"ws://\" + Config.ROSBRIDGE_SERVER_IP + \":\" + Config.ROSBRIDGE_SERVER_PORT + \"\");\n        } catch (error) {\n          console.error(\"Connection problem : TELEOP\");\n        }\n      }, Config.RECONNECTION_TIMER);\n    });\n    this.state.ros.on(\"error\", error => {});\n\n    try {\n      this.state.ros.connect(\"ws://\" + Config.ROSBRIDGE_SERVER_IP + \":\" + Config.ROSBRIDGE_SERVER_PORT + \"\");\n    } catch (error) {\n      console.error(\"Connection problem : TELEOP\");\n    }\n  }\n\n  move(evt, data) {\n    var max_linear = 5.0; // m/s\n\n    var max_angular = 2.0; // rad/s\n\n    var max_distance = 75.0; // pixels;\n\n    var linear_speed = Math.sin(data.angle.radian) * max_linear * data.distance / max_distance;\n    var angular_speed = -Math.cos(data.angle.radian) * max_angular * data.distance / max_distance;\n    this.setState({\n      linear: linear_speed,\n      angular: angular_speed\n    });\n  }\n\n  moveAction() {\n    let {\n      linear,\n      angular\n    } = this.state; //create a ROS publisher to /cmd_vel\n\n    var cmd_vel = new ROSLIB.Topic({\n      ros: this.state.ros,\n      name: Config.CMD_VEL_TOPIC,\n      messageType: \"geometry_msgs/Twist\"\n    });\n\n    if (this.state.stopPub) {\n      linear = 0.0;\n      angular = 0.0;\n      clearInterval(this.cmdPubTimer);\n      this.setState({\n        stopPub: false\n      });\n    }\n\n    let twist = new ROSLIB.Message({\n      linear: {\n        x: 0,\n        y: 0,\n        z: 0\n      },\n      angular: {\n        x: 0,\n        y: 0,\n        z: 0\n      }\n    });\n\n    if (linear !== undefined && angular !== undefined) {\n      twist.linear.x = linear;\n      twist.angular.z = angular;\n    } else {\n      twist.linear.x = 0;\n      twist.angular.z = 0;\n    }\n\n    cmd_vel.publish(twist);\n  }\n\n  loopMoveAction() {\n    this.cmdPubTimer = setInterval(this.moveAction, 25);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(ReactNipple, {\n        options: {\n          mode: 'static',\n          position: {\n            top: '50%',\n            left: '50%'\n          },\n          color: '#0066ff',\n          size: 150\n        },\n        style: {\n          width: 150,\n          height: 150,\n          position: 'relative'\n        },\n        onMove: (evt, data) => this.move(evt, data),\n        onStart: (evt, data) => this.loopMoveAction(),\n        onEnd: (evt, data) => this.setState({\n          stopPub: true\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Joystck;","map":{"version":3,"sources":["/home/alan/git/joystck-ros/src/Components/Joystck.js"],"names":["React","Component","ReactNipple","ROSLIB","Config","Joystck","constructor","state","ros","cmdVelPublisher","linear","angular","stopPub","init_connection","move","bind","moveAction","Ros","on","console","info","warn","setTimeout","connect","ROSBRIDGE_SERVER_IP","ROSBRIDGE_SERVER_PORT","error","RECONNECTION_TIMER","evt","data","max_linear","max_angular","max_distance","linear_speed","Math","sin","angle","radian","distance","angular_speed","cos","setState","cmd_vel","Topic","name","CMD_VEL_TOPIC","messageType","clearInterval","cmdPubTimer","twist","Message","x","y","z","undefined","publish","loopMoveAction","setInterval","render","mode","position","top","left","color","size","width","height"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport ReactNipple from 'react-nipple';\nimport ROSLIB from 'roslib';\nimport Config from \"./config\";\n\nclass Joystck extends Component {\n\n    state = {\n\t\tros : null,\n        cmdVelPublisher: null,\n        linear: 0,\n        angular: 0,\n        stopPub: false,\n\t};\n\tconstructor(){\n\t\tsuper();\n\t\tthis.init_connection();\n        this.move = this.move.bind(this);\n        this.moveAction = this.moveAction.bind(this);\n\t}\n\n\tinit_connection(){\n\t\t// eslint-disable-next-line\n\t\tthis.state.ros = new ROSLIB.Ros();\n\n\t\tthis.state.ros.on(\"connection\", () => {\n\t\t\tconsole.info(\"Connected to ROS:TELEOP\");\n\t\t});\n\n\t\tthis.state.ros.on(\"close\", () => {\n\t\t\tconsole.warn(\"Disconnected from ROS:TELEOP\");\n\t\t\tsetTimeout(()=>{\n\t\t\t\ttry{\n\t\t\t\t\tthis.state.ros.connect(\n\t\t\t\t\t\t\"ws://\"+Config.ROSBRIDGE_SERVER_IP+\":\"+Config.ROSBRIDGE_SERVER_PORT+\"\"\n\t\t\t\t\t);\n\t\t\t\t}catch(error){\n\t\t\t\t\tconsole.error(\"Connection problem : TELEOP\");\n\t\t\t\t}\n\t\t\t},Config.RECONNECTION_TIMER);\n\t\t});\n\n\t\tthis.state.ros.on(\"error\", (error) => {});\n\n\t\ttry{\n\t\t\tthis.state.ros.connect(\n\t\t\t\t\"ws://\"+Config.ROSBRIDGE_SERVER_IP+\":\"+Config.ROSBRIDGE_SERVER_PORT+\"\"\n\t\t\t);\n\t\t}catch(error){\n\t\t\tconsole.error(\"Connection problem : TELEOP\");\n\t\t}\n\t}\n    move(evt, data) {\n\n        var max_linear = 5.0; // m/s\n        var max_angular = 2.0; // rad/s\n        var max_distance = 75.0; // pixels;\n        var linear_speed = Math.sin(data.angle.radian) * max_linear * data.distance/max_distance;\n        var angular_speed = -Math.cos(data.angle.radian) * max_angular * data.distance/max_distance;\n\n        this.setState({linear: linear_speed, angular: angular_speed});\n    }\n\n    moveAction() {\n\n        let {linear, angular} = this.state;\n\n        //create a ROS publisher to /cmd_vel\n\t\tvar cmd_vel = new ROSLIB.Topic({\n\t\t\tros: this.state.ros,\n\t\t\tname: Config.CMD_VEL_TOPIC,\n\t\t\tmessageType: \"geometry_msgs/Twist\"\n\t\t});\n\n        if(this.state.stopPub){\n            linear = 0.0;\n            angular = 0.0;\n            clearInterval(this.cmdPubTimer)\n            this.setState({stopPub: false})\n        }\n\n        let twist = new ROSLIB.Message({ \n            linear: { x: 0, y: 0, z: 0 },\n            angular: { x: 0, y: 0, z: 0 }\n        });\n\n        if (linear !== undefined && angular !== undefined) {\n            twist.linear.x = linear;\n            twist.angular.z = angular;\n        } else {\n            twist.linear.x = 0;\n            twist.angular.z = 0;\n        }\n        cmd_vel.publish(twist);\n    }\n\n    loopMoveAction() {\n\n        this.cmdPubTimer = setInterval(this.moveAction, 25);\n    }\n\n    render() {\n        return (\n            <div>\n                <ReactNipple\n                    options={{ mode: 'static', position: { top: '50%', left: '50%' }, color: '#0066ff', size: 150 }}\n                    style={{\n                        width: 150,\n                        height: 150,\n                        position: 'relative'\n                    }}\n                    onMove={(evt, data) => this.move(evt, data)}\n                    onStart={(evt, data) => this.loopMoveAction()}\n                    onEnd={(evt, data) => this.setState({stopPub: true})}\n                    />\n            </div>\n        );\n    }\n}\n\nexport default Joystck;"]},"metadata":{},"sourceType":"module"}